<%# Vamos usar a variável 'produto' em vez de 'product' para manter a consistência %>
<% const produto = product; %>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= produto.nome %> - Alcool.bet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/stylesheets/produto.css">
    <link rel="stylesheet" href="/stylesheets/style.css">
</head>
<body class="text-amber-900">
    <header class="topo"></header>

    <%# --- PAINEL DE ADMIN  --- %>
<% if (locals.isAdmin) { %>
    <div class="admin-panel" style="background-color: #1f2937; color: white; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; display: flex; align-items: center; gap: 1rem;">
        <h3 style="margin: 0; font-size: 1.1rem; font-weight: bold;">Painel do Administrador:</h3>
        
        <a href="/admin/produtos/editar/<%= produto.id %>" class="admin-btn-edit" style="background-color: #f97316; padding: 0.5rem 1rem; border-radius: 5px; text-decoration: none; color: white;">Editar</a>

        <form action="/admin/produtos/excluir/<%= produto.id %>" method="POST" onsubmit="return confirm('Tem certeza que deseja excluir este produto? Esta ação não pode ser desfeita.');">
            <button type="submit" class="admin-btn-delete" style="background-color: #dc2626; padding: 0.5rem 1rem; border-radius: 5px; border: none; color: white; cursor: pointer;">Excluir</button>
        </form>
    </div>
<% } %>


    <main class="container mx-auto px-4 py-8">
        <section class="mb-12">
            <div class="flex flex-col md:flex-row gap-8">
                <div class="w-full md:w-1/2 bg-white rounded-lg shadow-md p-4 flex items-center justify-center">
                    <img src="<%= produto.imagem %>" alt="<%= produto.nome %>" class="max-h-[400px] object-contain">
                </div>
                <div class="w-full md:w-1/2">
                    <h1 class="text-2xl md:text-3xl font-bold mb-2"><%= produto.nome %></h1>
                    
                    <div class="flex items-center mb-4">
                        <div class="star-rating flex mr-2">
                            <span class="star filled">★</span><span class="star filled">★</span><span class="star filled">★</span><span class="star filled">★</span><span class="star">★</span>
                        </div>
                        <span class="text-amber-600 text-sm">(0) avaliações</span>
                    </div>
                    
                    <div class="mb-6">
                
                        <p class="text-3xl ...">R$ <%= parseFloat(produto.preco).toFixed(2).replace('.',',') %></p>
                    </div>
                    
                    <div class="mb-6">
                
                        <p class="<%= produto.quantidade > 0 ? 'text-emerald-600' : 'text-red-600' %> font-medium">
                            <i class="fas <%= produto.quantidade > 0 ? 'fa-check-circle' : 'fa-times-circle' %> mr-1"></i>
                            <%= produto.quantidade > 0 ? 'Disponível em estoque' : 'Produto esgotado' %>
                        </p>
                        <% if(produto.quantidade > 0) { %>
                            <p class="text-sm text-amber-600"><%= produto.quantidade %> unidades disponíveis</p>
                        <% } %>
                    </div>
                    
                    <div class="flex items-center mb-6">
                        <div class="mr-4">
                         <label class="block text-sm font-medium mb-1">Quantidade</label>
                    <div class="flex border border-amber-300 rounded-md">
                        <button id="btn-minus" type="button" class="px-3 py-1 bg-amber-100 text-amber-800">-</button>
                        
                        <input id="input-quantidade" type="number" value="1" min="1" max="<%= produto.quantidade %>" class="w-12 text-center px-1 border-x border-amber-300">
                        
                        <button id="btn-plus" type="button" class="px-3 py-1 bg-amber-100 text-amber-800">+</button>
                    </div>
                </div>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-2">
                            <button class="px-6 py-3 bg-amber-700 text-white rounded-md hover:bg-amber-800 transition font-medium">Comprar agora</button>
                            <button class="px-6 py-3 bg-amber-200 text-amber-800 rounded-md hover:bg-amber-300 transition font-medium">Adicionar ao carrinho</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="mb-12">
            <h2 class="text-xl font-bold mb-4 pb-2 border-b border-amber-200">Detalhes do Produto</h2>
            <div class="prose max-w-none">
                <p><%= produto.descricao %></p>
            </div>
        </section>
        
        </main>

    <footer>...</footer>
    <script>
    // Espera o documento carregar completamente
    document.addEventListener('DOMContentLoaded', () => {
        const btnMinus = document.getElementById('btn-minus');
        const btnPlus = document.getElementById('btn-plus');
        const inputQuantidade = document.getElementById('input-quantidade');
        
        // Pega o estoque máximo do atributo 'max' do input
        const maxEstoque = parseInt(inputQuantidade.max, 10);

        // Adiciona o evento de clique ao botão de AUMENTAR
        btnPlus.addEventListener('click', () => {
            let valorAtual = parseInt(inputQuantidade.value, 10);
            // Só aumenta se a quantidade for menor que o estoque
            if (valorAtual < maxEstoque) {
                inputQuantidade.value = valorAtual + 1;
            }
        });

        // Adiciona o evento de clique ao botão de DIMINUIR
        btnMinus.addEventListener('click', () => {
            let valorAtual = parseInt(inputQuantidade.value, 10);
            // Só diminui se a quantidade for maior que 1
            if (valorAtual > 1) {
                inputQuantidade.value = valorAtual - 1;
            }
        });
    });
</script>
</body>
</html>